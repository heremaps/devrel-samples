{"version":3,"file":"hds-dropdown.js","sourceRoot":"","sources":["../src/hds-dropdown.ts"],"names":[],"mappings":"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","sourcesContent":["import {customElement, BaseElement} from '@here/hds-base';\nimport '@here/hds-icon';\nimport {ListSelectPayload, List, ListItem} from '@here/hds-list';\nimport {html, LitElement, PropertyValues} from 'lit';\nimport {property, query} from 'lit/decorators.js';\nimport {classMap} from 'lit/directives/class-map.js';\nimport {styles} from './hds-dropdown.css.js';\nimport {computePosition, autoPlacement, Placement, offset} from '@floating-ui/dom';\n\nexport type DropdownVariant = 'solid' | 'subtle';\nexport type DropdownSize = 'small' | 'medium' | 'large';\nexport type DropdownPlacement =\n  | 'auto'\n  | 'top'\n  | 'top-start'\n  | 'top-end'\n  | 'right'\n  | 'right-start'\n  | 'right-end'\n  | 'bottom'\n  | 'bottom-start'\n  | 'bottom-end'\n  | 'left'\n  | 'left-start'\n  | 'left-end';\nexport type DropdownChangePayload = {open: boolean};\n\n/**\n * @slot trigger Element to be the trigger for the dropdown menu\n * @slot toggle Label for the toggle element\n * @slot menu Element `hds-list` for the items of the dropdown menu\n *\n * @event {CustomEvent<{open: boolean}>} change Fired when the dropdown has been changed: expanded/collapsed `DropdownChangePayload`\n * @event {CustomEvent<{id: string; index: number}>} select Fired when an item from the menu has been selected `ListSelectPayload`\n */\n@customElement('hds-dropdown')\nexport class Dropdown extends BaseElement {\n  static styles = styles;\n  static shadowRootOptions = {...LitElement.shadowRootOptions, delegatesFocus: true};\n  static utils = {computePosition, autoPlacement, offset};\n\n  isTabbable = true;\n  @property({type: Boolean, reflect: true}) open = false;\n  @property({type: String}) placement: DropdownPlacement = 'bottom';\n  @property({type: Boolean, attribute: 'hide-on-scroll'}) hideOnScroll = false;\n\n  @property({\n    type: Array,\n    attribute: 'allowed-placements',\n    converter: {\n      fromAttribute: value => value?.split(',') as DropdownPlacement[],\n    },\n  })\n  allowedPlacements: DropdownPlacement[] = ['top', 'right', 'bottom', 'left'];\n\n  @query('[name=\"menu\"]') protected menuSlot!: HTMLElement;\n  @query('.menu-wrapper') protected menuWrapper!: HTMLElement;\n\n  constructor() {\n    super();\n    this._handleKeydown = this._handleKeydown.bind(this);\n    this._handleClickOutside = this._handleClickOutside.bind(this);\n    this._handleScroll = this._handleScroll.bind(this);\n  }\n\n  connectedCallback() {\n    super.connectedCallback && super.connectedCallback();\n    this._addEventListeners();\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback && super.disconnectedCallback();\n    this._removeEventListeners();\n  }\n\n  protected async updated(changedPropertyValues: PropertyValues) {\n    if (changedPropertyValues.has('open') && changedPropertyValues.get('open') !== undefined) {\n      this.dispatchEvent(\n        new CustomEvent<DropdownChangePayload>('change', {\n          detail: {\n            open: this.open,\n          },\n          bubbles: true,\n          composed: true,\n        })\n      );\n    }\n\n    if (this.open) {\n      this.updatePosition();\n      (this._getMenu()[0] as HTMLElement).focus();\n    }\n  }\n\n  protected async updatePosition() {\n    const isAuto = this.getAttribute('placement') === 'auto';\n    const offsetFn = Dropdown.utils.offset(8);\n    const autoPlacementFn = isAuto\n      ? Dropdown.utils.autoPlacement({\n          allowedPlacements: this.allowedPlacements as Placement[],\n        })\n      : undefined;\n    const middleware = isAuto ? [autoPlacementFn, offsetFn] : [offsetFn];\n    const placement = isAuto ? undefined : (this.placement as Placement);\n\n    const pos = await Dropdown.utils.computePosition(this, this.menuWrapper, {\n      placement,\n      strategy: 'fixed',\n      middleware,\n    });\n\n    Object.assign(this.menuWrapper.style, {\n      top: `${pos.y}px`,\n      left: `${pos.x}px`,\n    });\n\n    this.placement = pos.placement;\n  }\n\n  protected render() {\n    const menuClasses = {\n      'menu-wrapper': true,\n      open: this.open,\n      [`placement-${this.placement}`]: true,\n    };\n\n    return html`\n      <div\n        id=\"hds-dropdown\"\n        class=\"hds-dropdown-wrapper\"\n        @click=\"${(e: MouseEvent) => e.stopPropagation()}\"\n        @select=\"${this._handleOnSelect}\"\n      >\n        <div class=\"trigger-wrapper\">\n          <slot name=\"trigger\" @click=\"${this._handleToggleClick}\"></slot>\n        </div>\n        <div class=\"${classMap(menuClasses)}\">\n          <slot name=\"menu\"></slot>\n        </div>\n      </div>\n    `;\n  }\n\n  private _handleKeydown(e: KeyboardEvent) {\n    // emits close event on Escape key down\n    if (e.key === 'Escape') {\n      this._handleClose();\n    }\n  }\n\n  private _handleClose() {\n    this.open = false;\n\n    this.querySelectorAll<ListItem>('hds-list-item[selected]').forEach(itemElement => {\n      const item = itemElement;\n      item.selected = false;\n    });\n\n    // TODO: review this after #1071 is closed\n    this.querySelectorAll<List>('hds-list').forEach(listElement => {\n      const list = listElement;\n      list.selectedIndex = -1;\n    });\n  }\n\n  private _handleClickOutside(e: Event) {\n    const closestDropdown =\n      (<HTMLElement>e.target).closest &&\n      (<HTMLElement>e.target).closest(this.tagName.toLowerCase());\n    if (closestDropdown !== this) {\n      this._handleClose();\n    }\n  }\n\n  private _removeEventListeners() {\n    this.ownerDocument.removeEventListener('click', this._handleClickOutside, true);\n    this.ownerDocument.removeEventListener('scroll', this._handleScroll, true);\n    this.ownerDocument.removeEventListener('wheel', this._handleScroll, true);\n    this.ownerDocument.removeEventListener('keydown', this._handleKeydown);\n    this.ownerDocument.defaultView?.removeEventListener('resize', this._handleScroll);\n  }\n\n  private _addEventListeners() {\n    this._removeEventListeners();\n    this.ownerDocument.addEventListener('click', this._handleClickOutside, true);\n    this.ownerDocument.addEventListener('scroll', this._handleScroll, true);\n    this.ownerDocument.addEventListener('wheel', this._handleScroll, true);\n    this.ownerDocument.addEventListener('keydown', this._handleKeydown);\n    this.ownerDocument.defaultView?.addEventListener('resize', this._handleScroll);\n  }\n\n  private async _handleOnSelect(e: CustomEvent<ListSelectPayload>) {\n    e.stopPropagation();\n    await this.updateComplete;\n    this.dispatchEvent(\n      new CustomEvent<ListSelectPayload>('select', {\n        detail: e.detail,\n        bubbles: true,\n        composed: true,\n      })\n    );\n\n    this._handleClose();\n  }\n\n  private async _handleToggleClick() {\n    this.open = !this.open;\n  }\n\n  private _getMenu() {\n    return (this.menuSlot as HTMLSlotElement).assignedNodes({flatten: true});\n  }\n\n  private _handleScroll() {\n    if (this.open) {\n      if (this.hideOnScroll) {\n        this.open = false;\n        this.requestUpdate('open', true);\n      } else {\n        this.updatePosition();\n      }\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'hds-dropdown': Dropdown;\n  }\n}\n"]}