{"version":3,"file":"hds-stepper.js","sourceRoot":"","sources":["../src/hds-stepper.ts"],"names":[],"mappings":"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","sourcesContent":["import {customElement} from '@here/hds-base';\nimport {html, LitElement, PropertyValues} from 'lit';\nimport {property, query} from 'lit/decorators.js';\nimport {classMap} from 'lit/directives/class-map.js';\nimport {StepConnector} from './hds-step-connector.js';\nimport {Step, StepActivateStepInternal, StepState} from './hds-step.js';\nimport {styles} from './hds-stepper.css.js';\n\nlet stepperCounter = 0;\n\nexport type StepperOrientation = 'vertical' | 'horizontal';\nexport type StepperCurrentActiveStepPayload = {currentState: StepState; stepIndex: number};\n\n/**\n * @slot default Content for the `hds-step` elements\n *\n * @event {CustomEvent<{currentState: StepState; stepIndex: number}>} current-active-step Fired when a new step has been selected `StepperCurrentActiveStepPayload`\n *\n */\n@customElement('hds-stepper')\nexport class Stepper extends LitElement {\n  static styles = styles;\n\n  @property({type: Boolean, attribute: 'non-linear'}) nonLinear = false;\n  @property({type: Boolean, attribute: 'hide-label'}) hideLabel = false;\n  @property({type: Boolean, attribute: 'bottom-label'}) bottomLabel = false;\n  @property({type: String}) orientation: StepperOrientation = 'horizontal';\n  @property({type: Number, reflect: true, attribute: 'active-step'}) activeStep: number = 0;\n  @property({type: Number, reflect: true, attribute: 'complete-step'}) completeStep?: number;\n  @property({type: Number, reflect: true, attribute: 'error-step'}) errorStep?: number;\n  @property({type: Number, attribute: false}) stepsLength: number = 0;\n\n  @query('slot') protected stepsSlot!: HTMLElement;\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.id = this.id || `hds-stepper-${++stepperCounter}`;\n    this.addEventListener('activate-step-internal', this._handleStepClick as EventListener);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeEventListener('activate-step-internal', this._handleStepClick as EventListener);\n  }\n\n  reset() {\n    const steps = this._getSteps() as Step[];\n    for (const step of steps) {\n      step.state = 'disabled';\n    }\n    this.completeStep = undefined;\n    this.activeStep = 0;\n  }\n\n  protected _handleStepClick({detail}: CustomEvent<StepActivateStepInternal>) {\n    if (detail) {\n      this.activeStep = detail.stepIndex;\n    }\n  }\n\n  protected firstUpdated(_changedProperties: PropertyValues) {\n    super.firstUpdated(_changedProperties);\n    this.setupStep();\n  }\n\n  protected async updated(_changedProperties: PropertyValues) {\n    super.updated(_changedProperties);\n\n    this.stepsLength = this._getSteps().length;\n\n    if (_changedProperties.has('activeStep')) {\n      await this.activeStepUpdated(_changedProperties.get('activeStep') as number);\n    }\n    if (_changedProperties.has('completeStep')) {\n      this.completeStepUpdated();\n    }\n    if (_changedProperties.has('errorStep')) {\n      this.errorStepUpdated();\n    }\n  }\n\n  protected async activeStepUpdated(oldVal: number) {\n    const steps = this._getSteps() as Step[];\n    const value = this.activeStep;\n    const selectedStep = steps[value] as Step;\n\n    if (!selectedStep) {\n      throw new Error('Invalid step index');\n    }\n\n    if (this.nonLinear) {\n      for (const step of steps) {\n        if (step.index !== value && step.state !== 'completed' && step.state !== 'error') {\n          step.state = 'disabled';\n        }\n      }\n      if (selectedStep.state !== 'completed' && selectedStep.state !== 'error') {\n        selectedStep.state = 'active';\n      }\n    } else {\n      // RULES FOR LINEAR MODE\n      // Below is the code for all ERROR case for skip and to check if last step is completed\n      if (value !== 0 && value - oldVal > 0) {\n        if (\n          (value - oldVal === 2 && steps[oldVal + 1] && !steps[oldVal + 1]?.optional) ||\n          (value - oldVal === 1 && steps[value - 2] && steps[value - 2].state !== 'completed') ||\n          value - oldVal > 2\n        ) {\n          this.activeStep = oldVal;\n          throw new Error(\n            'In linear mode, you can only activate this step if the last step is completed or optional'\n          );\n        }\n      }\n\n      // Below is the code for changing states base on direction\n      if (value > oldVal && steps[oldVal]) {\n        steps[oldVal].state = 'completed';\n      } else if (value < oldVal && steps[oldVal]) {\n        steps[oldVal].state = 'disabled';\n      }\n\n      // Finally setting selectedStep active\n      selectedStep.state = 'active';\n    }\n    this.dispatchEvent(\n      new CustomEvent<StepperCurrentActiveStepPayload>('current-active-step', {\n        detail: {\n          currentState: selectedStep.state,\n          stepIndex: value,\n        },\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  protected completeStepUpdated() {\n    if (this.completeStep === undefined) return;\n    const steps = this._getSteps() as Step[];\n    const selectedStep = steps[this.completeStep] as Step;\n    if (!selectedStep) {\n      throw new Error('Invalid step index');\n    } else if (selectedStep.state !== 'active' && selectedStep.state !== 'error') {\n      throw new Error('You can only complete the currently active or errored step');\n    } else {\n      selectedStep.state = 'completed';\n    }\n    // completeStep set to default/ undefined to allow updates for exceptions when same value is set again.\n    this.completeStep = undefined;\n  }\n\n  protected errorStepUpdated() {\n    if (this.errorStep === undefined) return;\n    const steps = this._getSteps() as Step[];\n    const selectedStep = steps[this.errorStep] as Step;\n    if (!selectedStep) {\n      throw new Error('Invalid step index');\n    }\n\n    if (!this.nonLinear) {\n      throw new Error(\"Step can't be set in error state in Linear mode\");\n    }\n\n    selectedStep.state = 'error';\n    this.errorStep = undefined;\n  }\n\n  protected setupStep() {\n    const steps = this._getSteps();\n\n    for (let i = 0; i < steps.length; i += 1) {\n      steps[i].index = i;\n      steps[i].bottomLabel = this.bottomLabel;\n      steps[i].orientation = this.orientation;\n      steps[i].hideLabel = this.hideLabel;\n      steps[i].nonLinear = this.nonLinear;\n\n      if (i === 0) {\n        steps[i].state = 'active';\n      } else if (i !== 0) {\n        steps[i].state = 'disabled';\n        if (this.orientation === 'vertical' || !this.bottomLabel) {\n          const stepConnector = new StepConnector();\n          stepConnector.bottomLabel = this.bottomLabel;\n          stepConnector.orientation = this.orientation;\n          steps[i]?.parentNode?.insertBefore(stepConnector, steps[i]);\n        }\n      }\n    }\n  }\n\n  protected render() {\n    const classes = {\n      'hds-stepper--label-bottom': this.orientation === 'horizontal' && this.bottomLabel,\n      [`hds-stepper--orientation-${this.orientation}`]: true,\n    };\n    return html`\n      <div role=\"group\" aria-label=\"progress\" class=\"hds-stepper-wrapper ${classMap(classes)}\">\n        <slot></slot>\n      </div>\n    `;\n  }\n\n  protected _getSteps() {\n    return (this.stepsSlot as HTMLSlotElement)\n      .assignedNodes({flatten: true})\n      .filter((e: Node) => e instanceof Step) as Step[];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'hds-stepper': Stepper;\n  }\n}\n"]}